THREE.ColladaLoader=function(){function Da(a,c,b){G=(new DOMParser).parseFromString(a,"text/xml");c=c||Ea;void 0!==b&&(a=b.split("/"),a.pop(),Fa=(1>a.length?".":a.join("/"))+"/");if((a=G.querySelectorAll("asset")[0])&&a.childNodes)for(b=0;b<a.childNodes.length;b++){var d=a.childNodes[b];switch(d.nodeName){case "unit":(d=d.getAttribute("meter"))&&(Ga=parseFloat(d));break;case "up_axis":T=d.textContent.charAt(0)}}if(!0!==u.convertUpAxis||T===u.upAxis)x=null;else switch(T){case "X":x="Y"===u.upAxis?
"XtoY":"XtoZ";break;case "Y":x="X"===u.upAxis?"YtoX":"YtoZ";break;case "Z":x="X"===u.upAxis?"ZtoX":"ZtoY"}Y=B("library_images image",ja,"image");ka=B("library_materials material",Ha,"material");la=B("library_effects effect",H,"effect");I=B("library_geometries geometry",Ia,"geometry");ma=B("library_cameras camera",na,"camera");oa=B("library_lights light",Z,"light");K=B("library_controllers controller",Ja,"controller");O=B("library_animations animation",pa,"animation");qa=B("library_visual_scenes visual_scene",
aa,"visual_scene");ra=B("library_kinematics_models kinematics_model",sa,"kinematics_model");ba=[];ca=[];(a=G.querySelectorAll("scene instance_visual_scene")[0])?(a=a.getAttribute("url").replace(/^#/,""),C=qa[0<a.length?a:"visual_scene0"]):C=null;P=new THREE.Group;for(a=0;a<C.nodes.length;a++)P.add(Ka(C.nodes[a]));P.scale.multiplyScalar(Ga);ta=[];La(P);(a=G.querySelectorAll("instance_kinematics_model")[0])?(a=a.getAttribute("url").replace(/^#/,""),J=ra[0<a.length?a:"kinematics_model0"]):J=null;ab();
a={scene:P,morphs:ba,skins:ca,animations:ta,kinematics:ua,dae:{images:Y,materials:ka,cameras:ma,lights:oa,effects:la,geometries:I,controllers:K,animations:O,visualScenes:qa,visualScene:C,scene:C,kinematicsModels:ra,kinematicsModel:J}};c&&c(a);return a}function B(a,c,b){a=G.querySelectorAll(a);for(var d={},f=0,e=a.length,g=0;g<e;g++){var h=a[g],h=(new c).parse(h);h.id&&0!==h.id.length||(h.id=b+f++);d[h.id]=h}return d}function La(a){var c=C.getChildById(a.colladaId,!0),b;if(c&&c.keys){b={fps:60,hierarchy:[{node:c,
keys:c.keys,sids:c.sids}],node:a,name:"animation_"+a.name,length:0};ta.push(b);for(var d=0,f=c.keys.length;d<f;d++)b.length=Math.max(b.length,c.keys[d].time)}else b={hierarchy:[{keys:[],sids:[]}]};d=0;for(f=a.children.length;d<f;d++)for(var c=0,e=La(a.children[d]).hierarchy.length;c<e;c++)b.hierarchy.push({keys:[],sids:[]});return b}function va(a,c,b,d){a.world=a.world||new THREE.Matrix4;a.localworld=a.localworld||new THREE.Matrix4;a.world.copy(a.matrix);a.localworld.copy(a.matrix);if(a.channels&&
a.channels.length){var f=a.channels[0].sampler.output[b];f instanceof THREE.Matrix4&&(a.world.copy(f),a.localworld.copy(f),0===b&&a.matrix.copy(f))}d&&a.world.multiplyMatrices(d,a.world);c.push(a);for(d=0;d<a.nodes.length;d++)va(a.nodes[d],c,b,a.world)}function Ma(a,c){for(var b=0;b<a.length;b++){var d=a[b],f=-1;if("JOINT"==d.type){for(var e=0;e<c.joints.length;e++)if(d.sid===c.joints[e]){f=e;break}if(0<=f)for(e=c.invBindMatrices[f],d.invBindMatrix=e,d.skinningMatrix=new THREE.Matrix4,d.skinningMatrix.multiplyMatrices(d.world,
e),d.animatrix=new THREE.Matrix4,d.animatrix.copy(d.localworld),d.weights=[],e=0;e<c.weights.length;e++)for(var g=0;g<c.weights[e].length;g++){var h=c.weights[e][g];h.joint===f&&d.weights.push(h)}else console.warn("ColladaLoader: Could not find joint '"+d.sid+"'."),d.skinningMatrix=new THREE.Matrix4,d.weights=[]}}}function bb(a){var c=[],b=function(a,c,e){var g={};g.name=c.sid;g.parent=a;g.matrix=c.matrix;a=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];g.matrix.decompose(a[0],a[1],a[2]);
g.pos=[a[0].x,a[0].y,a[0].z];g.scl=[a[2].x,a[2].y,a[2].z];g.rotq=[a[1].x,a[1].y,a[1].z,a[1].w];e.push(g);for(var h in c.nodes)b(c.sid,c.nodes[h],e)};b(-1,a,c);return c}function Na(a,c,b){var d,f=K[c.url];if(f&&f.skin)if(c.skeleton&&c.skeleton.length){var e=0,g;for(d in O){b=O[d];g=g||b.id;for(var h=0;h<b.sampler.length;h++){var k=b.sampler[h];k.create();e=Math.max(e,k.input.length)}}d=e;b=g;c=C.getChildById(c.skeleton[0],!0)||C.getChildBySid(c.skeleton[0],!0);g=bb(c);for(var l=f.skin.joints,h=[],
e=0;e<l.length;e++)for(k=0;k<g.length;k++)g[k].name===l[e]&&(h[e]=g[k]);for(e=0;e<h.length;e++)for(k=0;k<h.length;k++)h[e].parent===h[k].name&&(h[e].parent=k);new THREE.Vector3;for(e=0;e<a.vertices.length;e++)a.vertices[e].applyMatrix4(f.skin.bindShapeMatrix);for(var k=[],l=[],m=f.skin.weights,e=0;e<m.length;e++){var p=new THREE.Vector4(m[e][0]?m[e][0].joint:0,m[e][1]?m[e][1].joint:0,m[e][2]?m[e][2].joint:0,m[e][3]?m[e][3].joint:0);g=new THREE.Vector4(m[e][0]?m[e][0].weight:0,m[e][1]?m[e][1].weight:
0,m[e][2]?m[e][2].weight:0,m[e][3]?m[e][3].weight:0);k.push(p);l.push(g)}a.skinIndices=k;a.skinWeights=l;a.bones=h;g={name:b,fps:30,length:d/30,hierarchy:[]};for(k=0;k<h.length;k++)g.hierarchy.push({parent:h[k].parent,name:h[k].name,keys:[]});console.log("ColladaLoader:",b+" has "+h.length+" bones.");e=[];va(c,e,-1);Ma(e,f.skin);b=new THREE.Vector3;h=[];for(k=0;k<a.vertices.length;k++)h.push(new THREE.Vector3);for(k=0;k<e.length;k++)if("JOINT"==e[k].type)for(l=0;l<e[k].weights.length;l++){var p=e[k].weights[l],
m=p.index,p=p.weight,n=a.vertices[m],m=h[m];b.x=n.x;b.y=n.y;b.z=n.z;b.applyMatrix4(e[k].skinningMatrix);m.x+=b.x*p;m.y+=b.y*p;m.z+=b.z*p}for(k=0;k<a.vertices.length;k++)a.vertices[k]=h[k];for(b=0;b<d;b++){h=[];va(c,h,b);Ma(h,f.skin);for(e=0;e<h.length;e++)for(k=0;k<g.hierarchy.length;k++)g.hierarchy[k].name===h[e].sid&&(l={},l.time=b/30,l.matrix=h[e].animatrix,0===b&&(h[e].matrix=l.matrix),m=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3],l.matrix.decompose(m[0],m[1],m[2]),l.pos=[m[0].x,
m[0].y,m[0].z],l.scl=[m[2].x,m[2].y,m[2].z],l.rot=m[1],g.hierarchy[k].keys.push(l));a.animation=g}}else console.log("ColladaLoader: Could not find the skeleton for the skin. ");else console.log("ColladaLoader: Could not find skin controller.")}function ab(){if(J&&0===J.joints.length)ua=void 0;else{var a={},c=function(b,c){var d=c.getAttribute("id"),e=C.getChildById(d,!0),f=J.joints[b];P.traverse(function(c){c.colladaId==d&&(a[b]={node:c,transforms:e.transforms,joint:f,position:f.zeroPosition})})};
ua={joints:J&&J.joints,getJointValue:function(b){var c=a[b];if(c)return c.position;console.log("getJointValue: joint "+b+" doesn't exist")},setJointValue:function(b,c){var e=a[b];if(e){var f=e.joint;if(c>f.limits.max||c<f.limits.min)console.log("setJointValue: joint "+b+" value "+c+" outside of limits (min: "+f.limits.min+", max: "+f.limits.max+")");else if(f["static"])console.log("setJointValue: joint "+b+" is static");else{var m=e.node,p=f.axis,e=e.transforms,n=new THREE.Matrix4;for(d=0;d<e.length;d++){var q=
e[d];if(q.sid&&-1!==q.sid.indexOf("joint"+b))switch(f.type){case "revolute":n.multiply(t.makeRotationAxis(p,THREE.Math.degToRad(c)));break;case "prismatic":n.multiply(t.makeTranslation(p.x*c,p.y*c,p.z*c));break;default:console.warn("setJointValue: unknown joint type: "+f.type)}else{var t=new THREE.Matrix4;switch(q.type){case "matrix":n.multiply(q.obj);break;case "translate":n.multiply(t.makeTranslation(q.obj.x,q.obj.y,q.obj.z));break;case "rotate":n.multiply(t.makeRotationAxis(q.obj,q.angle))}}}f=
Array.prototype.slice.call(n.elements);m.matrix.set.apply(m.matrix,[f[0],f[4],f[8],f[12],f[1],f[5],f[9],f[13],f[2],f[6],f[10],f[14],f[3],f[7],f[11],f[15]]);m.matrix.decompose(m.position,m.quaternion,m.scale)}}else console.log("setJointValue: joint "+b+" doesn't exist")}};var b=G.querySelector("scene instance_kinematics_scene");if(b)for(var d=0;d<b.childNodes.length;d++){var f=b.childNodes[d];if(1==f.nodeType)switch(f.nodeName){case "bind_joint_axis":var e=f.getAttribute("target").split("/").pop(),
f=f.querySelector("axis param").textContent,f=parseInt(f.split("joint").pop().split(".")[0]);(e=G.querySelector('[sid="'+e+'"]'))&&c(f,e.parentElement)}}}}function Ka(a,c){var b=new THREE.Object3D,d,f,e,g;for(e=0;e<a.controllers.length;e++){var h=K[a.controllers[e].url];switch(h.type){case "skin":if(I[h.skin.source]){var k=new U;k.url=h.skin.source;k.instance_material=a.controllers[e].instance_material;a.geometries.push(k);d=a.controllers[e]}else K[h.skin.source]&&(f=h=K[h.skin.source],h.morph&&I[h.morph.source]&&
(k=new U,k.url=h.morph.source,k.instance_material=a.controllers[e].instance_material,a.geometries.push(k)));break;case "morph":I[h.morph.source]&&(k=new U,k.url=h.morph.source,k.instance_material=a.controllers[e].instance_material,a.geometries.push(k),f=a.controllers[e]),console.log("ColladaLoader: Morph-controller partially supported.")}}k={};for(e=0;e<a.geometries.length;e++){g=a.geometries[e];var h=g.instance_material,l=I[g.url],m={},p=[],n=0,q;if(l&&l.mesh&&l.mesh.primitives){0===b.name.length&&
(b.name=l.id);if(h)for(g=0;g<h.length;g++){q=h[g];var t=ka[q.target],v=la[t.instance_effect.url].shader.material;l.doubleSided&&(q.symbol in k||(v=v.clone(),v.side=THREE.DoubleSide,k[q.symbol]=v),v=k[q.symbol]);v.opacity=v.opacity?v.opacity:1;m[q.symbol]=n;p.push(v);q=v;q.name=null===t.name||""===t.name?t.id:t.name;n++}h=q||new THREE.MeshLambertMaterial({color:14540253,side:l.doubleSided?THREE.DoubleSide:THREE.FrontSide});l=l.mesh.geometry3js;if(1<n)for(h=new THREE.MultiMaterial(p),g=0;g<l.faces.length;g++)p=
l.faces[g],p.materialIndex=m[p.daeMaterial];if(void 0!==d)Na(l,d),0<l.morphTargets.length?(h.morphTargets=!0,h.skinning=!1):(h.morphTargets=!1,h.skinning=!0),h=new THREE.SkinnedMesh(l,h,!1),h.name="skin_"+ca.length,ca.push(h);else if(void 0!==f){g=l;if((m=f instanceof wa?K[f.url]:f)&&m.morph){m=m.morph;for(p=0;p<m.targets.length;p++)n=I[m.targets[p]],n.mesh&&n.mesh.primitives&&n.mesh.primitives.length&&(n=n.mesh.primitives[0].geometry,n.vertices.length===g.vertices.length&&g.morphTargets.push({name:"target_1",
vertices:n.vertices}));g.morphTargets.push({name:"target_Z",vertices:g.vertices})}else console.log("could not find morph controller!");h.morphTargets=!0;h=new THREE.Mesh(l,h);h.name="morph_"+ba.length;ba.push(h)}else h=!0===l.isLineStrip?new THREE.Line(l):new THREE.Mesh(l,h);b.add(h)}}for(e=0;e<a.cameras.length;e++)d=ma[a.cameras[e].url],d=new THREE.PerspectiveCamera(d.yfov,parseFloat(d.aspect_ratio),parseFloat(d.znear),parseFloat(d.zfar)),b.add(d);for(e=0;e<a.lights.length;e++){d=null;if((f=oa[a.lights[e].url])&&
f.technique)switch(k=f.color.getHex(),q=f.intensity,h=f.distance,g=f.falloff_angle,f.technique){case "directional":d=new THREE.DirectionalLight(k,q,h);d.position.set(0,0,1);break;case "point":d=new THREE.PointLight(k,q,h);break;case "spot":d=new THREE.SpotLight(k,q,h,g);d.position.set(0,0,1);break;case "ambient":d=new THREE.AmbientLight(k)}d&&b.add(d)}b.name=a.name||a.id||"";b.colladaId=a.id||"";b.layer=a.layer||"";b.matrix=a.matrix;b.matrix.decompose(b.position,b.quaternion,b.scale);u.centerGeometry&&
b.geometry&&(e=b.geometry.center(),e.multiply(b.scale),e.applyQuaternion(b.quaternion),b.position.sub(e));for(e=0;e<a.nodes.length;e++)b.add(Ka(a.nodes[e],a));return b}function ja(){this.init_from=this.id=""}function Ja(){this.type=this.name=this.id="";this.morph=this.skin=null}function xa(){this.weights=this.targets=this.source=this.method=null}function da(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}function aa(){this.name=this.id="";this.nodes=
[];this.scene=new THREE.Group}function E(){this.sid=this.name=this.id="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new THREE.Matrix4}function L(){this.type=this.sid="";this.data=[];this.obj=null}function wa(){this.url="";this.skeleton=[];this.instance_material=[]}function ya(){this.target=this.symbol=""}function U(){this.url="";this.instance_material=[]}function Ia(){this.id="";this.mesh=null}function za(a){this.geometry=a.id;this.primitives=
[];this.geometry3js=this.vertices=null}function F(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new THREE.Geometry}function ea(){F.call(this);this.vcount=[]}function V(){F.call(this);this.vcount=1}function fa(){F.call(this);this.vcount=3}function Oa(){this.source="";this.stride=this.count=0;this.params=[]}function Pa(){this.input={}}function M(){this.semantic="";this.offset=0;this.source="";this.set=0}function Q(a){this.id=a;this.type=null}function Ha(){this.name=
this.id="";this.instance_effect=null}function D(){this.color=new THREE.Color;this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texOpts=this.texcoord=this.texture=null}function Aa(a,c){this.type=a;this.effect=c;this.material=null}function Qa(a){this.effect=a;this.format=this.init_from=null}function Ra(a){this.effect=a;this.mipfilter=this.magfilter=this.minfilter=this.wrap_t=this.wrap_s=this.source=null}function H(){this.name=this.id="";this.shader=null;this.surface={};
this.sampler={}}function Sa(){this.url=""}function pa(){this.name=this.id="";this.source={};this.sampler=[];this.channel=[]}function Ta(a){this.animation=a;this.target=this.source="";this.member=this.arrIndices=this.arrSyntax=this.dotSyntax=this.sid=this.fullSid=null}function ga(a){this.id="";this.animation=a;this.inputs=[];this.endTime=this.startTime=this.interpolation=this.strideOut=this.output=this.input=null;this.duration=0}function R(a){this.targets=[];this.time=a}function na(){this.technique=
this.name=this.id=""}function Ua(){this.url=""}function Z(){this.technique=this.name=this.id=""}function Va(){this.url=""}function sa(){this.name=this.id="";this.joints=[];this.links=[]}function Wa(){this.name=this.sid="";this.axis=new THREE.Vector3;this.limits={min:0,max:0};this.type="";this["static"]=!1;this.middlePosition=this.zeroPosition=0}function Ba(){this.name=this.sid="";this.transforms=[];this.attachments=[]}function Xa(){this.joint="";this.transforms=[];this.links=[]}function S(a){a=ha(a);
for(var c=[],b=0,d=a.length;b<d;b++)c.push(parseFloat(a[b]));return c}function W(a){a=ha(a);for(var c=[],b=0,d=a.length;b<d;b++)c.push(parseInt(a[b],10));return c}function ha(a){return 0<a.length?a.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/):[]}function X(a,c,b){return a.hasAttribute(c)?parseInt(a.getAttribute(c),10):b}function cb(a,c){(new THREE.ImageLoader).load(c,function(b){a.image=b;a.needsUpdate=!0})}function Ya(a,c){a.doubleSided=!1;var b=c.querySelectorAll("extra double_sided")[0];
b&&b&&1===parseInt(b.textContent,10)&&(a.doubleSided=!0)}function w(a,c){if(!0===u.convertUpAxis&&T!==u.upAxis)switch(x){case "XtoY":var b=a[0];a[0]=c*a[1];a[1]=b;break;case "XtoZ":b=a[2];a[2]=a[1];a[1]=a[0];a[0]=b;break;case "YtoX":b=a[0];a[0]=a[1];a[1]=c*b;break;case "YtoZ":b=a[1];a[1]=c*a[2];a[2]=b;break;case "ZtoX":b=a[0];a[0]=a[1];a[1]=a[2];a[2]=b;break;case "ZtoY":b=a[1],a[1]=a[2],a[2]=c*b}}function ia(a,c){var b=[a[c],a[c+1],a[c+2]];w(b,-1);return new THREE.Vector3(b[0],b[1],b[2])}function Ca(a){if(u.convertUpAxis){var c=
[a[0],a[4],a[8]];w(c,-1);a[0]=c[0];a[4]=c[1];a[8]=c[2];c=[a[1],a[5],a[9]];w(c,-1);a[1]=c[0];a[5]=c[1];a[9]=c[2];c=[a[2],a[6],a[10]];w(c,-1);a[2]=c[0];a[6]=c[1];a[10]=c[2];c=[a[0],a[1],a[2]];w(c,-1);a[0]=c[0];a[1]=c[1];a[2]=c[2];c=[a[4],a[5],a[6]];w(c,-1);a[4]=c[0];a[5]=c[1];a[6]=c[2];c=[a[8],a[9],a[10]];w(c,-1);a[8]=c[0];a[9]=c[1];a[10]=c[2];c=[a[3],a[7],a[11]];w(c,-1);a[3]=c[0];a[7]=c[1];a[11]=c[2]}return(new THREE.Matrix4).set(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],
a[13],a[14],a[15])}function Za(a){if(u.convertUpAxis)switch(a){case "X":switch(x){case "XtoY":case "XtoZ":case "YtoX":a="Y";break;case "ZtoX":a="Z"}break;case "Y":switch(x){case "XtoY":case "YtoX":case "ZtoX":a="X";break;case "XtoZ":case "YtoZ":case "ZtoY":a="Z"}break;case "Z":switch(x){case "XtoZ":a="X";break;case "YtoZ":case "ZtoX":case "ZtoY":a="Y"}}return a}var G=null,P=null,C,J,Ea=null,N={},Y={},O={},K={},I={},ka={},la={},ma={},oa={},ta,ua,qa,ra,Fa,ba,ca,$a=THREE.SmoothShading,u={centerGeometry:!1,
convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},Ga=1,T="Y",x=null;ja.prototype.parse=function(a){this.id=a.getAttribute("id");for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];"init_from"===b.nodeName&&(this.init_from=b.textContent)}return this};Ja.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");this.type="none";for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];switch(b.nodeName){case "skin":this.skin=(new da).parse(b);
this.type=b.nodeName;break;case "morph":this.morph=(new xa).parse(b),this.type=b.nodeName}}return this};xa.prototype.parse=function(a){var c={},b=[],d;this.method=a.getAttribute("method");this.source=a.getAttribute("source").replace(/^#/,"");for(d=0;d<a.childNodes.length;d++){var f=a.childNodes[d];if(1==f.nodeType)switch(f.nodeName){case "source":f=(new Q).parse(f);c[f.id]=f;break;case "targets":b=this.parseInputs(f);break;default:console.log(f.nodeName)}}for(d=0;d<b.length;d++)switch(a=b[d],f=c[a.source],
a.semantic){case "MORPH_TARGET":this.targets=f.read();break;case "MORPH_WEIGHT":this.weights=f.read()}return this};xa.prototype.parseInputs=function(a){for(var c=[],b=0;b<a.childNodes.length;b++){var d=a.childNodes[b];if(1==d.nodeType)switch(d.nodeName){case "input":c.push((new M).parse(d))}}return c};da.prototype.parse=function(a){var c={},b,d;this.source=a.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var f=0;f<a.childNodes.length;f++){var e=
a.childNodes[f];if(1==e.nodeType)switch(e.nodeName){case "bind_shape_matrix":e=S(e.textContent);this.bindShapeMatrix=Ca(e);break;case "source":e=(new Q).parse(e);c[e.id]=e;break;case "joints":b=e;break;case "vertex_weights":d=e;break;default:console.log(e.nodeName)}}this.parseJoints(b,c);this.parseWeights(d,c);return this};da.prototype.parseJoints=function(a,c){for(var b=0;b<a.childNodes.length;b++){var d=a.childNodes[b];if(1==d.nodeType)switch(d.nodeName){case "input":var d=(new M).parse(d),f=c[d.source];
"JOINT"===d.semantic?this.joints=f.read():"INV_BIND_MATRIX"===d.semantic&&(this.invBindMatrices=f.read())}}};da.prototype.parseWeights=function(a,c){for(var b,d,f=[],e=0;e<a.childNodes.length;e++){var g=a.childNodes[e];if(1==g.nodeType)switch(g.nodeName){case "input":f.push((new M).parse(g));break;case "v":b=W(g.textContent);break;case "vcount":d=W(g.textContent)}}for(e=g=0;e<d.length;e++){for(var h=d[e],k=[],l=0;l<h;l++){for(var m={},p=0;p<f.length;p++){var n=f[p],q=b[g+n.offset];switch(n.semantic){case "JOINT":m.joint=
q;break;case "WEIGHT":m.weight=c[n.source].data[q]}}k.push(m);g+=f.length}for(l=0;l<k.length;l++)k[l].index=e;this.weights.push(k)}};aa.prototype.getChildById=function(a,c){for(var b=0;b<this.nodes.length;b++){var d=this.nodes[b].getChildById(a,c);if(d)return d}return null};aa.prototype.getChildBySid=function(a,c){for(var b=0;b<this.nodes.length;b++){var d=this.nodes[b].getChildBySid(a,c);if(d)return d}return null};aa.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");
this.nodes=[];for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "node":this.nodes.push((new E).parse(b))}}return this};E.prototype.getChannelForTransform=function(a){for(var c=0;c<this.channels.length;c++){var b=this.channels[c],d=b.target.split("/");d.shift();var f=d.shift(),e=0<=f.indexOf("."),g=0<=f.indexOf("("),h;if(e)d=f.split("."),f=d.shift(),d.shift();else if(g)for(h=f.split("("),f=h.shift(),d=0;d<h.length;d++)h[d]=parseInt(h[d].replace(/\)/,
""));if(f===a)return b.info={sid:f,dotSyntax:e,arrSyntax:g,arrIndices:h},b}return null};E.prototype.getChildById=function(a,c){if(this.id===a)return this;if(c)for(var b=0;b<this.nodes.length;b++){var d=this.nodes[b].getChildById(a,c);if(d)return d}return null};E.prototype.getChildBySid=function(a,c){if(this.sid===a)return this;if(c)for(var b=0;b<this.nodes.length;b++){var d=this.nodes[b].getChildBySid(a,c);if(d)return d}return null};E.prototype.getTransformBySid=function(a){for(var c=0;c<this.transforms.length;c++)if(this.transforms[c].sid===
a)return this.transforms[c];return null};E.prototype.parse=function(a){var c;this.id=a.getAttribute("id");this.sid=a.getAttribute("sid");this.name=a.getAttribute("name");this.type=a.getAttribute("type");this.layer=a.getAttribute("layer");this.type="JOINT"===this.type?this.type:"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.cameras=[];this.lights=[];this.controllers=[];this.matrix=new THREE.Matrix4;for(var b=0;b<a.childNodes.length;b++)if(c=a.childNodes[b],1==c.nodeType)switch(c.nodeName){case "node":this.nodes.push((new E).parse(c));
break;case "instance_camera":this.cameras.push((new Ua).parse(c));break;case "instance_controller":this.controllers.push((new wa).parse(c));break;case "instance_geometry":this.geometries.push((new U).parse(c));break;case "instance_light":this.lights.push((new Va).parse(c));break;case "instance_node":c=c.getAttribute("url").replace(/^#/,"");a:{for(var d=G.querySelectorAll("library_nodes node"),f=0;f<d.length;f++){var e=d[f].attributes.getNamedItem("id");if(e&&e.value===c){c=d[f];break a}}c=void 0}c&&
this.nodes.push((new E).parse(c));break;case "rotate":case "translate":case "scale":case "matrix":case "lookat":case "skew":this.transforms.push((new L).parse(c));break;case "extra":break;default:console.log(c.nodeName)}a=[];b=1E6;c=-1E6;for(var g in O)for(d=O[g],f=0;f<d.channel.length;f++){var e=d.channel[f],h=d.sampler[f];g=e.target.split("/")[0];g==this.id&&(h.create(),e.sampler=h,b=Math.min(b,h.startTime),c=Math.max(c,h.endTime),a.push(e))}a.length&&(this.startTime=b,this.endTime=c);if((this.channels=
a)&&this.channels.length){g=[];a=[];b=0;for(d=this.channels.length;b<d;b++){var k=this.channels[b],f=k.fullSid,e=k.sampler,h=e.input,l=this.getTransformBySid(k.sid),m;if(k.arrIndices){m=[];c=0;for(var p=k.arrIndices.length;c<p;c++){var n=m,q=c,t=k.arrIndices[c];-1<t&&3>t&&(t=Za(["X","Y","Z"][t]),t={X:0,Y:1,Z:2}[t]);n[q]=t}}else m=Za(k.member);if(l)for(-1===a.indexOf(f)&&a.push(f),c=0,p=h.length;c<p;c++){for(var n=h[c],k=e.getData(l.type,c,m),q=null,t=0,v=g.length;t<v&&null===q;t++){var u=g[t];if(u.time===
n)q=u;else if(u.time>n)break}if(!q){q=new R(n);t=-1;v=0;for(u=g.length;v<u&&-1===t;v++)g[v].time>=n&&(t=v);n=t;g.splice(-1===n?g.length:n,0,q)}q.addTarget(f,l,m,k)}else console.log('Could not find transform "'+k.sid+'" in node '+this.id)}for(b=0;b<a.length;b++)for(d=a[b],c=0;c<g.length;c++)if(q=g[c],!q.hasTarget(d)){h=g;f=q;m=c;e=d;a:{l=m?m-1:0;for(l=0<=l?l:l+h.length;0<=l;l--)if(p=h[l],p.hasTarget(e)){l=p;break a}l=null}a:{for(m+=1;m<h.length;m++)if(p=h[m],p.hasTarget(e)){m=p;break a}m=null}if(l&&
m){h=(f.time-l.time)/(m.time-l.time);l=l.getTarget(e);m=m.getTarget(e).data;p=l.data;if("matrix"===l.type)k=p;else if(p.length)for(k=[],n=0;n<p.length;++n)k[n]=p[n]+(m[n]-p[n])*h;else k=p+(m-p)*h;f.addTarget(e,l.transform,l.member,k)}}this.keys=g;this.sids=a}this.updateMatrix();return this};E.prototype.updateMatrix=function(){this.matrix.identity();for(var a=0;a<this.transforms.length;a++)this.transforms[a].apply(this.matrix)};L.prototype.parse=function(a){this.sid=a.getAttribute("sid");this.type=
a.nodeName;this.data=S(a.textContent);this.convert();return this};L.prototype.convert=function(){switch(this.type){case "matrix":this.obj=Ca(this.data);break;case "rotate":this.angle=THREE.Math.degToRad(this.data[3]);case "translate":w(this.data,-1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case "scale":w(this.data,1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}};L.prototype.apply=
function(){var a=new THREE.Matrix4;return function(c){switch(this.type){case "matrix":c.multiply(this.obj);break;case "translate":c.multiply(a.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case "rotate":c.multiply(a.makeRotationAxis(this.obj,this.angle));break;case "scale":c.scale(this.obj)}}}();L.prototype.update=function(a,c){var b=["X","Y","Z","ANGLE"];switch(this.type){case "matrix":if(c)if(1===c.length)switch(c[0]){case 0:this.obj.n11=a[0];this.obj.n21=a[1];this.obj.n31=a[2];this.obj.n41=
a[3];break;case 1:this.obj.n12=a[0];this.obj.n22=a[1];this.obj.n32=a[2];this.obj.n42=a[3];break;case 2:this.obj.n13=a[0];this.obj.n23=a[1];this.obj.n33=a[2];this.obj.n43=a[3];break;case 3:this.obj.n14=a[0],this.obj.n24=a[1],this.obj.n34=a[2],this.obj.n44=a[3]}else 2===c.length?this.obj["n"+(c[0]+1)+(c[1]+1)]=a:console.log("Incorrect addressing of matrix in transform.");else this.obj.copy(a);break;case "translate":case "scale":"[object Array]"===Object.prototype.toString.call(c)&&(c=b[c[0]]);switch(c){case "X":this.obj.x=
a;break;case "Y":this.obj.y=a;break;case "Z":this.obj.z=a;break;default:this.obj.x=a[0],this.obj.y=a[1],this.obj.z=a[2]}break;case "rotate":switch("[object Array]"===Object.prototype.toString.call(c)&&(c=b[c[0]]),c){case "X":this.obj.x=a;break;case "Y":this.obj.y=a;break;case "Z":this.obj.z=a;break;case "ANGLE":this.angle=THREE.Math.degToRad(a);break;default:this.obj.x=a[0],this.obj.y=a[1],this.obj.z=a[2],this.angle=THREE.Math.degToRad(a[3])}}};wa.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,
"");this.skeleton=[];this.instance_material=[];for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1===b.nodeType)switch(b.nodeName){case "skeleton":this.skeleton.push(b.textContent.replace(/^#/,""));break;case "bind_material":for(var b=b.querySelectorAll("instance_material"),d=0;d<b.length;d++){var f=b[d];this.instance_material.push((new ya).parse(f))}}}return this};ya.prototype.parse=function(a){this.symbol=a.getAttribute("symbol");this.target=a.getAttribute("target").replace(/^#/,"");
return this};U.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType&&"bind_material"===b.nodeName){a=b.querySelectorAll("instance_material");for(c=0;c<a.length;c++)b=a[c],this.instance_material.push((new ya).parse(b));break}}return this};Ia.prototype.parse=function(a){this.id=a.getAttribute("id");Ya(this,a);for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];switch(b.nodeName){case "mesh":this.mesh=
(new za(this)).parse(b)}}return this};za.prototype.parse=function(a){this.primitives=[];for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];switch(b.nodeName){case "source":var d=b.getAttribute("id");void 0==N[d]&&(N[d]=(new Q(d)).parse(b));break;case "vertices":this.vertices=(new Pa).parse(b);break;case "linestrips":this.primitives.push((new V).parse(b));break;case "triangles":this.primitives.push((new fa).parse(b));break;case "polygons":this.primitives.push((new F).parse(b));break;case "polylist":this.primitives.push((new ea).parse(b))}}this.geometry3js=
new THREE.Geometry;if(null===this.vertices)return this;a=N[this.vertices.input.POSITION.source].data;for(c=0;c<a.length;c+=3)this.geometry3js.vertices.push(ia(a,c).clone());for(c=0;c<this.primitives.length;c++)a=this.primitives[c],a.setVertices(this.vertices),this.handlePrimitive(a,this.geometry3js);this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals);return this};za.prototype.handlePrimitive=function(a,c){if(a instanceof V)c.isLineStrip=!0;else{var b,
d,f=a.p,e=a.inputs,g,h,k,l,m,p=0,n,q=0,t=[];for(b=0;b<e.length;b++)switch(g=e[b],n=g.offset+1,q=q<n?n:q,g.semantic){case "TEXCOORD":t.push(g.set)}for(var v=0;v<f.length;++v)for(var w=f[v],x=0;x<w.length;){var r=[],y=[],A=null,z=[];n=a.vcount?a.vcount.length?a.vcount[p++]:a.vcount:w.length/q;for(b=0;b<n;b++)for(d=0;d<e.length;d++)switch(g=e[d],l=N[g.source],h=w[x+b*q+g.offset],m=l.accessor.params.length,k=h*m,g.semantic){case "VERTEX":r.push(h);break;case "NORMAL":y.push(ia(l.data,k));break;case "TEXCOORD":A=
A||{};void 0===A[g.set]&&(A[g.set]=[]);A[g.set].push(new THREE.Vector2(l.data[k],l.data[k+1]));break;case "COLOR":z.push((new THREE.Color).setRGB(l.data[k],l.data[k+1],l.data[k+2]))}if(0===y.length)if(g=this.vertices.input.NORMAL)for(l=N[g.source],m=l.accessor.params.length,b=0,h=r.length;b<h;b++)y.push(ia(l.data,r[b]*m));else c.calcNormals=!0;if(!A&&(A={},g=this.vertices.input.TEXCOORD))for(t.push(g.set),l=N[g.source],m=l.accessor.params.length,b=0,h=r.length;b<h;b++)k=r[b]*m,void 0===A[g.set]&&
(A[g.set]=[]),A[g.set].push(new THREE.Vector2(l.data[k],1-l.data[k+1]));if(0===z.length&&(g=this.vertices.input.COLOR))for(l=N[g.source],m=l.accessor.params.length,b=0,h=r.length;b<h;b++)k=r[b]*m,z.push((new THREE.Color).setRGB(l.data[k],l.data[k+1],l.data[k+2]));g=[];if(3===n)g.push(new THREE.Face3(r[0],r[1],r[2],y,z.length?z:new THREE.Color));else if(4===n)g.push(new THREE.Face3(r[0],r[1],r[3],y.length?[y[0].clone(),y[1].clone(),y[3].clone()]:[],z.length?[z[0],z[1],z[3]]:new THREE.Color)),g.push(new THREE.Face3(r[1],
r[2],r[3],y.length?[y[1].clone(),y[2].clone(),y[3].clone()]:[],z.length?[z[1],z[2],z[3]]:new THREE.Color));else if(4<n&&u.subdivideFaces)for(b=z.length?z:new THREE.Color,d=1;d<n-1;)g.push(new THREE.Face3(r[0],r[d],r[d+1],y.length?[y[0].clone(),y[d++].clone(),y[d].clone()]:[],b));if(g.length)for(b=0,h=g.length;b<h;b++)for(d=g[b],d.daeMaterial=a.material,c.faces.push(d),d=0;d<t.length;d++)r=A[t[d]],r=4<n?[r[0],r[b+1],r[b+2]]:4===n?0===b?[r[0],r[1],r[3]]:[r[1].clone(),r[2],r[3].clone()]:[r[0],r[1],r[2]],
void 0===c.faceVertexUvs[d]&&(c.faceVertexUvs[d]=[]),c.faceVertexUvs[d].push(r);else console.log("dropped face with vcount "+n+" for geometry with id: "+c.id);x+=q*n}}};F.prototype.setVertices=function(a){for(var c=0;c<this.inputs.length;c++)this.inputs[c].source===a.id&&(this.inputs[c].source=a.input.POSITION.source)};F.prototype.parse=function(a){this.material=a.getAttribute("material");this.count=X(a,"count",0);for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];switch(b.nodeName){case "input":this.inputs.push((new M).parse(a.childNodes[c]));
break;case "vcount":this.vcount=W(b.textContent);break;case "p":this.p.push(W(b.textContent));break;case "ph":console.warn("polygon holes not yet supported!")}}return this};ea.prototype=Object.create(F.prototype);ea.prototype.constructor=ea;V.prototype=Object.create(F.prototype);V.prototype.constructor=V;fa.prototype=Object.create(F.prototype);fa.prototype.constructor=fa;Oa.prototype.parse=function(a){this.params=[];this.source=a.getAttribute("source");this.count=X(a,"count",0);this.stride=X(a,"stride",
0);for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if("param"===b.nodeName){var d={};d.name=b.getAttribute("name");d.type=b.getAttribute("type");this.params.push(d)}}return this};Pa.prototype.parse=function(a){this.id=a.getAttribute("id");for(var c=0;c<a.childNodes.length;c++)if("input"===a.childNodes[c].nodeName){var b=(new M).parse(a.childNodes[c]);this.input[b.semantic]=b}return this};M.prototype.parse=function(a){this.semantic=a.getAttribute("semantic");this.source=a.getAttribute("source").replace(/^#/,
"");this.set=X(a,"set",-1);this.offset=X(a,"offset",0);"TEXCOORD"===this.semantic&&0>this.set&&(this.set=0);return this};Q.prototype.parse=function(a){this.id=a.getAttribute("id");for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];switch(b.nodeName){case "bool_array":for(var d=ha(b.textContent),f=[],e=0,g=d.length;e<g;e++)f.push("true"===d[e]||"1"===d[e]?!0:!1);this.data=f;this.type=b.nodeName;break;case "float_array":this.data=S(b.textContent);this.type=b.nodeName;break;case "int_array":this.data=
W(b.textContent);this.type=b.nodeName;break;case "IDREF_array":case "Name_array":this.data=ha(b.textContent);this.type=b.nodeName;break;case "technique_common":for(d=0;d<b.childNodes.length;d++)if("accessor"===b.childNodes[d].nodeName){this.accessor=(new Oa).parse(b.childNodes[d]);break}}}return this};Q.prototype.read=function(){var a=[],c=this.accessor.params[0];switch(c.type){case "IDREF":case "Name":case "name":case "float":return this.data;case "float4x4":for(c=0;c<this.data.length;c+=16){var b=
this.data.slice(c,c+16),b=Ca(b);a.push(b)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+c.type+".")}return a};Ha.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");for(var c=0;c<a.childNodes.length;c++)if("instance_effect"===a.childNodes[c].nodeName){this.instance_effect=(new Sa).parse(a.childNodes[c]);break}return this};D.prototype.isColor=function(){return null===this.texture};D.prototype.isTexture=function(){return null!=this.texture};
D.prototype.parse=function(a){"transparent"===a.nodeName&&(this.opaque=a.getAttribute("opaque"));for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "color":b=S(b.textContent);this.color=new THREE.Color;this.color.setRGB(b[0],b[1],b[2]);this.color.a=b[3];break;case "texture":this.texture=b.getAttribute("texture"),this.texcoord=b.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(b)}}return this};
D.prototype.parseTexture=function(a){if(!a.childNodes)return this;a.childNodes[1]&&"extra"===a.childNodes[1].nodeName&&(a=a.childNodes[1],a.childNodes[1]&&"technique"===a.childNodes[1].nodeName&&(a=a.childNodes[1]));for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];switch(b.nodeName){case "offsetU":case "offsetV":case "repeatU":case "repeatV":this.texOpts[b.nodeName]=parseFloat(b.textContent);break;case "wrapU":case "wrapV":"TRUE"===b.textContent.toUpperCase()?this.texOpts[b.nodeName]=
1:this.texOpts[b.nodeName]=parseInt(b.textContent);break;default:this.texOpts[b.nodeName]=b.textContent}}return this};Aa.prototype.parse=function(a){for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "emission":case "diffuse":case "specular":case "transparent":this[b.nodeName]=(new D).parse(b);break;case "bump":var d=b.getAttribute("bumptype");d?"heightfield"===d.toLowerCase()?this.bump=(new D).parse(b):"normalmap"===d.toLowerCase()?this.normal=(new D).parse(b):
(console.error("Shader.prototype.parse: Invalid value for attribute 'bumptype' ("+d+") - valid bumptypes are 'HEIGHTFIELD' and 'NORMALMAP' - defaulting to 'HEIGHTFIELD'"),this.bump=(new D).parse(b)):(console.warn("Shader.prototype.parse: Attribute 'bumptype' missing from bump node - defaulting to 'HEIGHTFIELD'"),this.bump=(new D).parse(b));break;case "shininess":case "reflectivity":case "index_of_refraction":case "transparency":d=b.querySelectorAll("float"),0<d.length&&(this[b.nodeName]=parseFloat(d[0].textContent))}}this.create();
return this};Aa.prototype.create=function(){var a={},c=!1;if(void 0!==this.transparency&&void 0!==this.transparent){var b=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;0<b&&(c=!0,a.transparent=!0,a.opacity=1-b)}var b={diffuse:"map",ambient:"lightMap",specular:"specularMap",emission:"emissionMap",bump:"bumpMap",normal:"normalMap"},d;for(d in this)switch(d){case "ambient":case "emission":case "diffuse":case "specular":case "bump":case "normal":var f=
this[d];if(f instanceof D)if(f.isTexture()){var e=this.effect.sampler[f.texture];if(void 0!==e&&void 0!==e.source&&(e=this.effect.surface[e.source],void 0!==e&&(e=Y[e.init_from]))){var e=Fa+e.init_from,g;g=THREE.Loader.Handlers.get(e);null!==g?g=g.load(e):(g=new THREE.Texture,cb(g,e));g.wrapS=f.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;g.wrapT=f.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;g.offset.x=f.texOpts.offsetU;g.offset.y=f.texOpts.offsetV;g.repeat.x=f.texOpts.repeatU;
g.repeat.y=f.texOpts.repeatV;a[b[d]]=g;"emission"===d&&(a.emissive=16777215)}}else"diffuse"!==d&&c||("emission"===d?a.emissive=f.color.getHex():a[d]=f.color.getHex());break;case "shininess":a[d]=this[d];break;case "reflectivity":a[d]=this[d];0<a[d]&&(a.envMap=u.defaultEnvMap);a.combine=THREE.MixOperation;break;case "index_of_refraction":a.refractionRatio=this[d],1!==this[d]&&(a.envMap=u.defaultEnvMap)}a.shading=$a;a.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide;void 0!==a.diffuse&&
(a.color=a.diffuse,delete a.diffuse);switch(this.type){case "constant":void 0!=a.emissive&&(a.color=a.emissive);this.material=new THREE.MeshBasicMaterial(a);break;case "phong":case "blinn":this.material=new THREE.MeshPhongMaterial(a);break;default:this.material=new THREE.MeshLambertMaterial(a)}return this.material};Qa.prototype.parse=function(a){for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "init_from":this.init_from=b.textContent;break;case "format":this.format=
b.textContent;break;default:console.log("unhandled Surface prop: "+b.nodeName)}}return this};Ra.prototype.parse=function(a){for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "source":this.source=b.textContent;break;case "minfilter":this.minfilter=b.textContent;break;case "magfilter":this.magfilter=b.textContent;break;case "mipfilter":this.mipfilter=b.textContent;break;case "wrap_s":this.wrap_s=b.textContent;break;case "wrap_t":this.wrap_t=b.textContent;
break;default:console.log("unhandled Sampler2D prop: "+b.nodeName)}}return this};H.prototype.create=function(){if(null===this.shader)return null};H.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");Ya(this,a);this.shader=null;for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(b))}}return this};H.prototype.parseNewparam=function(a){for(var c=a.getAttribute("sid"),
b=0;b<a.childNodes.length;b++){var d=a.childNodes[b];if(1==d.nodeType)switch(d.nodeName){case "surface":this.surface[c]=(new Qa(this)).parse(d);break;case "sampler2D":this.sampler[c]=(new Ra(this)).parse(d);break;case "extra":break;default:console.log(d.nodeName)}}};H.prototype.parseProfileCOMMON=function(a){for(var c,b=0;b<a.childNodes.length;b++){var d=a.childNodes[b];if(1==d.nodeType)switch(d.nodeName){case "profile_COMMON":this.parseProfileCOMMON(d);break;case "technique":c=d;break;case "newparam":this.parseNewparam(d);
break;case "image":d=(new ja).parse(d);Y[d.id]=d;break;case "extra":break;default:console.log(d.nodeName)}}return c};H.prototype.parseTechnique=function(a){for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "constant":case "lambert":case "blinn":case "phong":this.shader=(new Aa(b.nodeName,this)).parse(b);break;case "extra":this.parseExtra(b)}}};H.prototype.parseExtra=function(a){for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "technique":this.parseExtraTechnique(b)}}};
H.prototype.parseExtraTechnique=function(a){for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "bump":this.shader.parse(a)}}};Sa.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,"");return this};pa.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");this.source={};for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "animation":var b=(new pa).parse(b),
d;for(d in b.source)this.source[d]=b.source[d];for(var f=0;f<b.channel.length;f++)this.channel.push(b.channel[f]),this.sampler.push(b.sampler[f]);break;case "source":d=(new Q).parse(b);this.source[d.id]=d;break;case "sampler":this.sampler.push((new ga(this)).parse(b));break;case "channel":this.channel.push((new Ta(this)).parse(b))}}return this};Ta.prototype.parse=function(a){this.source=a.getAttribute("source").replace(/^#/,"");this.target=a.getAttribute("target");var c=this.target.split("/");c.shift();
a=c.shift();var b=0<=a.indexOf("."),d=0<=a.indexOf("(");if(b)c=a.split("."),this.sid=c.shift(),this.member=c.shift();else if(d){c=a.split("(");this.sid=c.shift();for(var f=0;f<c.length;f++)c[f]=parseInt(c[f].replace(/\)/,""));this.arrIndices=c}else this.sid=a;this.fullSid=a;this.dotSyntax=b;this.arrSyntax=d;return this};ga.prototype.parse=function(a){this.id=a.getAttribute("id");this.inputs=[];for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "input":this.inputs.push((new M).parse(b))}}return this};
ga.prototype.create=function(){for(var a=0;a<this.inputs.length;a++){var c=this.inputs[a],b=this.animation.source[c.source];switch(c.semantic){case "INPUT":this.input=b.read();break;case "OUTPUT":this.output=b.read();this.strideOut=b.accessor.stride;break;case "INTERPOLATION":this.interpolation=b.read();break;case "IN_TANGENT":break;case "OUT_TANGENT":break;default:console.log(c.semantic)}}this.duration=this.endTime=this.startTime=0;if(this.input.length){this.startTime=1E8;this.endTime=-1E8;for(a=
0;a<this.input.length;a++)this.startTime=Math.min(this.startTime,this.input[a]),this.endTime=Math.max(this.endTime,this.input[a]);this.duration=this.endTime-this.startTime}};ga.prototype.getData=function(a,c,b){var d;if("matrix"===a&&16===this.strideOut)d=this.output[c];else if(1<this.strideOut){d=[];c*=this.strideOut;for(b=0;b<this.strideOut;++b)d[b]=this.output[c+b];if(3===this.strideOut)switch(a){case "rotate":case "translate":w(d,-1);break;case "scale":w(d,1)}else 4===this.strideOut&&"matrix"===
a&&w(d,-1)}else if(d=this.output[c],b&&"translate"===a){a=d;if(!0===u.convertUpAxis&&T!==u.upAxis)switch(b){case "X":a="XtoY"===x?-1*a:a;break;case "Y":a="YtoZ"===x||"YtoX"===x?-1*a:a;break;case "Z":a="ZtoY"===x?-1*a:a}d=a}return d};R.prototype.addTarget=function(a,c,b,d){this.targets.push({sid:a,member:b,transform:c,data:d})};R.prototype.apply=function(a){for(var c=0;c<this.targets.length;++c){var b=this.targets[c];a&&b.sid!==a||b.transform.update(b.data,b.member)}};R.prototype.getTarget=function(a){for(var c=
0;c<this.targets.length;++c)if(this.targets[c].sid===a)return this.targets[c];return null};R.prototype.hasTarget=function(a){for(var c=0;c<this.targets.length;++c)if(this.targets[c].sid===a)return!0;return!1};R.prototype.interpolate=function(a,c){for(var b=0,d=this.targets.length;b<d;b++){var f=this.targets[b],e=a.getTarget(f.sid);if("matrix"!==f.transform.type&&e){var g=(c-this.time)/(a.time-this.time),h=e.data,k=f.data;0>g&&(g=0);1<g&&(g=1);if(k.length)for(var e=[],l=0;l<k.length;++l)e[l]=k[l]+
(h[l]-k[l])*g;else e=k+(h-k)*g}else e=f.data;f.transform.update(e,f.member)}};na.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "optics":this.parseOptics(b)}}return this};na.prototype.parseOptics=function(a){for(var c=0;c<a.childNodes.length;c++)if("technique_common"===a.childNodes[c].nodeName)for(var b=a.childNodes[c],d=0;d<b.childNodes.length;d++)if(this.technique=
b.childNodes[d].nodeName,"perspective"===this.technique)for(var f=b.childNodes[d],e=0;e<f.childNodes.length;e++){var g=f.childNodes[e];switch(g.nodeName){case "yfov":this.yfov=g.textContent;break;case "xfov":this.xfov=g.textContent;break;case "znear":this.znear=g.textContent;break;case "zfar":this.zfar=g.textContent;break;case "aspect_ratio":this.aspect_ratio=g.textContent}}else if("orthographic"===this.technique)for(f=b.childNodes[d],e=0;e<f.childNodes.length;e++)switch(g=f.childNodes[e],g.nodeName){case "xmag":this.xmag=
g.textContent;break;case "ymag":this.ymag=g.textContent;break;case "znear":this.znear=g.textContent;break;case "zfar":this.zfar=g.textContent;break;case "aspect_ratio":this.aspect_ratio=g.textContent}return this};Ua.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,"");return this};Z.prototype.parse=function(a){this.id=a.getAttribute("id");this.name=a.getAttribute("name");for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "technique_common":this.parseCommon(b);
break;case "technique":this.parseTechnique(b)}}return this};Z.prototype.parseCommon=function(a){for(var c=0;c<a.childNodes.length;c++)switch(a.childNodes[c].nodeName){case "directional":case "point":case "spot":case "ambient":this.technique=a.childNodes[c].nodeName;for(var b=a.childNodes[c],d=0;d<b.childNodes.length;d++){var f=b.childNodes[d];switch(f.nodeName){case "color":f=S(f.textContent);this.color=new THREE.Color(0);this.color.setRGB(f[0],f[1],f[2]);this.color.a=f[3];break;case "falloff_angle":this.falloff_angle=
parseFloat(f.textContent);break;case "quadratic_attenuation":this.distance=(f=parseFloat(f.textContent))?Math.sqrt(1/f):0}}}return this};Z.prototype.parseTechnique=function(a){this.profile=a.getAttribute("profile");for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];switch(b.nodeName){case "intensity":this.intensity=parseFloat(b.textContent)}}return this};Va.prototype.parse=function(a){this.url=a.getAttribute("url").replace(/^#/,"");return this};sa.prototype.parse=function(a){this.id=a.getAttribute("id");
this.name=a.getAttribute("name");this.joints=[];this.links=[];for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "technique_common":this.parseCommon(b)}}return this};sa.prototype.parseCommon=function(a){for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(a.childNodes[c].nodeName){case "joint":this.joints.push((new Wa).parse(b));break;case "link":this.links.push((new Ba).parse(b))}}return this};Wa.prototype.parse=function(a){this.sid=
a.getAttribute("sid");this.name=a.getAttribute("name");this.axis=new THREE.Vector3;this.limits={min:0,max:0};this.type="";this["static"]=!1;this.middlePosition=this.zeroPosition=0;var c=a.querySelector("axis"),c=S(c.textContent);this.axis=ia(c,0);var c=a.querySelector("limits min")?parseFloat(a.querySelector("limits min").textContent):-360,b=a.querySelector("limits max")?parseFloat(a.querySelector("limits max").textContent):360;this.limits={min:c,max:b};c=["prismatic","revolute"];for(b=0;b<c.length;b++){var d=
c[b];a.querySelector(d)&&(this.type=d)}this.limits.min>=this.limits.max&&(this["static"]=!0);this.middlePosition=(this.limits.min+this.limits.max)/2;return this};Ba.prototype.parse=function(a){this.sid=a.getAttribute("sid");this.name=a.getAttribute("name");this.transforms=[];this.attachments=[];for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "attachment_full":this.attachments.push((new Xa).parse(b));break;case "rotate":case "translate":case "matrix":this.transforms.push((new L).parse(b))}}return this};
Xa.prototype.parse=function(a){this.joint=a.getAttribute("joint").split("/").pop();this.links=[];for(var c=0;c<a.childNodes.length;c++){var b=a.childNodes[c];if(1==b.nodeType)switch(b.nodeName){case "link":this.links.push((new Ba).parse(b));break;case "rotate":case "translate":case "matrix":this.transforms.push((new L).parse(b))}}return this};return{load:function(a,c,b,d){var f=0;if(document.implementation&&document.implementation.createDocument){var e=new XMLHttpRequest;e.onreadystatechange=function(){4===
e.readyState?0===e.status||200===e.status?e.response?(Ea=c,Da(e.response,void 0,a)):d?d({type:"error",url:a}):console.error("ColladaLoader: Empty or non-existing file ("+a+")"):d?d({type:"error",url:a}):console.error("ColladaLoader: Couldn't load \""+a+'" ('+e.status+")"):3===e.readyState&&b&&(0===f&&(f=e.getResponseHeader("Content-Length")),b({total:f,loaded:e.responseText.length}))};e.open("GET",a,!0);e.send(null)}else alert("Don't know how to parse XML!")},parse:Da,setPreferredShading:function(a){$a=
a},applySkin:Na,geometries:I,options:u}};
